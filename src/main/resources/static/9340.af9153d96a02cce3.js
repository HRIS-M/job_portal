"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[9340],{9340:(R,y,a)=>{a.r(y),a.d(y,{StripeElementModule:()=>N});var l,L=a(177),u=a(3331),d=a(467),S="https://js.stripe.com/v3",j=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,g="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",E=function(i){var e=i&&!i.advancedFraudSignals?"?advancedFraudSignals=false":"",t=document.createElement("script");t.src="".concat(S).concat(e);var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(t),t},c=null,m=null,p=null,w=!1,I=function(){return l||(l=(i=null,null!==c?c:(c=new Promise(function(e,t){if(typeof window>"u"||typeof document>"u")e(null);else if(window.Stripe&&i&&console.warn(g),window.Stripe)e(window.Stripe);else try{var n=function(){for(var i=document.querySelectorAll('script[src^="'.concat(S,'"]')),e=0;e<i.length;e++){var t=i[e];if(j.test(t.src))return t}return null}();if(n&&i)console.warn(g);else if(n){if(n&&null!==p&&null!==m){var s;n.removeEventListener("load",p),n.removeEventListener("error",m),null===(s=n.parentNode)||void 0===s||s.removeChild(n),n=E(i)}}else n=E(i);p=function(i,e){return function(){window.Stripe?i(window.Stripe):e(new Error("Stripe.js not available"))}}(e,t),m=function(i){return function(){i(new Error("Failed to load Stripe.js"))}}(t),n.addEventListener("load",p),n.addEventListener("error",m)}catch(v){return void t(v)}})).catch(function(e){return c=null,Promise.reject(e)})).catch(function(i){return l=null,Promise.reject(i)}));var i};Promise.resolve().then(function(){return I()}).catch(function(r){w||console.warn(r)});var C=function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];w=!0;var n=Date.now();return I().then(function(s){return function(i,e,t){if(null===i)return null;var n=i.apply(void 0,e);return function(i,e){!i||!i._registerWrapper||i._registerWrapper({name:"stripe-js",version:"4.6.0",startTime:e})}(n,t),n}(s,e,n)})},f=a(5312),o=a(4438),b=a(2617),X=a(1294),P=a(4034),h=a(1626);let k=(()=>{class r{constructor(e){this.http=e,this.simpleBaseUrl=f.c.apiUrlSimple}createPaymentIntent(e,t){const n=new h.Lr({Authorization:"Basic "+btoa("admin:password")});return this.http.post(`${this.simpleBaseUrl}/api/payments/create-payment-intent`,{companyId:e,planName:t},{headers:n})}createCheckoutSession(e,t){return new h.Lr({Authorization:"Basic "+btoa("admin:password")}),this.http.post(`${this.simpleBaseUrl}/webhook/create-checkout-session`,{companyId:e,planName:t})}static{this.\u0275fac=function(t){return new(t||r)(o.KVO(h.Qq))}}static{this.\u0275prov=o.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();const B=[{path:"",component:(()=>{class r{constructor(e,t,n,s,v,O){this.alertService=e,this.cookieService=t,this.router=n,this.route=s,this.stripeService=v,this.paymentService=O,this.planName="Pro",this.isLoading=!1}ngOnInit(){var e=this;return(0,d.A)(function*(){sessionStorage.getItem("in_payment_progress")||(e.alertService.errorMessage("We detected some suspicious activity. If you face this trouble again and again please contact support!","Error"),setInterval(()=>{e.router.navigate(["/cart"])},5e3)),e.companyId=e.cookieService.organization(),e.stripe=yield C(f.c.stripe_key)})()}ngAfterViewInit(){this.createPaymentIntent()}createPaymentIntent(){this.isLoading=!0,this.paymentService.createPaymentIntent(this.companyId,this.planName).subscribe(e=>{this.clientSecret=e.clientSecret,this.loadPaymentElement().then(t=>{this.isLoading=!1})},e=>{this.isLoading=!1,this.alertService.errorMessage(e.error.message,"Error")})}loadPaymentElement(){var e=this;return(0,d.A)(function*(){e.elements=e.stripe.elements({clientSecret:e.clientSecret,appearance:{theme:"flat",variables:{fontFamily:"Helvetica, Arial, sans-serif",colorBackground:"#f5f5f5",colorText:"#333"}}}),e.elements.create("payment",{layout:{type:"accordion",defaultCollapsed:!1,radios:!0,spacedAccordionItems:!0}}).mount("#payment-element")})()}pay(){var e=this;return(0,d.A)(function*(){e.companyId?e.paymentService.createCheckoutSession(e.companyId,e.planName).subscribe(t=>{t&&e.redirectToCheckout(t.id)},t=>{e.alertService.errorMessage("Failed to initiate payment. Please try again.","error")}):(sessionStorage.removeItem("in_payment_progress"),e.alertService.errorMessage("You need to register as a company first","error"))})()}redirectToCheckout(e){var t=this;return(0,d.A)(function*(){(yield C(f.c.stripe_key)).redirectToCheckout({sessionId:e}).then(s=>{sessionStorage.removeItem("in_payment_progress"),s.error&&t.alertService.errorMessage("Error redirecting to Stripe Checkout:"+s.error.message,"error")})})()}static{this.\u0275fac=function(t){return new(t||r)(o.rXU(b.n),o.rXU(X.u),o.rXU(u.Ix),o.rXU(u.nX),o.rXU(P.d$),o.rXU(k))}}static{this.\u0275cmp=o.VBU({type:r,selectors:[["app-stripe-element"]],decls:4,vars:0,consts:[[1,"container"],["id","payment-element"],[1,"btn-1","w-100",3,"click"]],template:function(t,n){1&t&&(o.j41(0,"div",0),o.nrm(1,"div",1),o.j41(2,"button",2),o.bIt("click",function(){return n.pay()}),o.EFF(3,"Pay"),o.k0s()())},styles:[".container[_ngcontent-%COMP%]{max-width:800px;padding:max(40px,5vw) 0}#payment-element[_ngcontent-%COMP%]{margin:20px 0}"]})}}return r})()}];let V=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=o.$C({type:r})}static{this.\u0275inj=o.G2t({imports:[u.iI.forChild(B),u.iI]})}}return r})();var G=a(9417);let N=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=o.$C({type:r})}static{this.\u0275inj=o.G2t({imports:[L.MD,V,P.zx,G.YN]})}}return r})()}}]);